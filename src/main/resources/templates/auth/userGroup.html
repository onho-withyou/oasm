<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/AuthLayout}">
<th:block layout:fragment="main">
<div class="mainTitleBar">
    <span>ë“±ê¸‰ ê¶Œí•œ ê´€ë¦¬ - ì‚¬ìš©ì ê·¸ë£¹ ê´€ë¦¬</span>
    <div class="btnbox">
        <div class="btndiv1">
            <button type="button" class="mainbtn" onclick="showPopup()">ë“±ë¡</button>
        </div>
        <div class="btndiv2">
            <button type="button" id="rtnDel" class="mainbtn">ì‚­ì œ</button>
        </div>
    </div>
</div>
<!-- í™”ë©´ ì•ˆ -->
<div class="main">
    <div class="usersetContainer">
        <span>ğŸŸ© ë“±ê¸‰ ëª©ë¡</span>
        <table class="usertable">
            <thead>
            <tr>
                <th><input type="checkbox" id="rtnAll"></th>
                <th>ë“±ê¸‰ ëª…</th>
                <th>ë“±ê¸‰ ì½”ë“œ</th>
                <th>ë¹„ê³ </th>
                <th></th>
            </tr>
            </thead>
            <tbody>
                <tr th:each="rt: ${ratings}">
                    <td>
                        <input type="checkbox" class="rtnCheck" th:value="${rt.rating_cd}">
                    </td>
                    <td th:text="${rt.rating_nm}"></td>
                    <td th:text="${rt.rating_cd}"></td>
                    <td th:text="${rt.rmk}"></td>
                    <td>
                        <button type="button" class="detailbtn" th:data-value="${rt.rating_cd}">ìƒì„¸ë³´ê¸°</button>
                    </td>
                </tr>
            </tbody>
        </table>

    </div>
    <div class="userGroupContainer">
        <span>ğŸŸ© íšŒì› ë“±ê¸‰</span>
        <div class="deleteBar">
            <form class="deleteform">
                <label>ì•„ì´ë””&nbsp;&nbsp;</label>
                <input type="text" class="inputId"/>
                <label>ë“±ê¸‰ ëª…&nbsp;&nbsp;</label>
                <select id="inputRtn">
                    <option value="all">ì„ íƒ</option>
                    <th:block th:each="rating : ${ratings}">
                        <option th:value="${rating.rating_cd}" th:text="${rating.rating_nm}"></option>
                    </th:block>
                </select>
                <label>ì‚¬ìš©ì ëª…&nbsp;&nbsp;</label>
                <input type="text" class="inputName" />
                <button type="button" id="userDel" class="deletebtn">ì‚­ì œ</button>
                <button type="button" class="usersearch" id="searchBtn"></button>
            </form>
        </div>
        <table class="memberLevel">
            <thead>
                <tr>
                    <th><input type="checkbox" id="userAll"></th>
                    <th>ì•„ì´ë””</th>
                    <th>ë“±ê¸‰ ëª…</th>
                    <th>ì‚¬ìš©ì ëª…</th>
                    <th>ë¹„ê³ </th>
                </tr>
            </thead>
            <tbody id="userTable">
                <tr th:each="user : ${users}">
                    <td>
                        <input type="checkbox" class="userCheck" th:value="${user.user_id}" th:data-code="${user.rating_cd}"/>
                    </td>
                    <td th:text="${user.user_id}"></td>
                    <td th:text="${user.rating_nm}"></td>
                    <td th:text="${user.user_nm}"></td>
                    <td th:text="${user.rmk}"></td>
                </tr>
            </tbody>
        </table>
        <div class="paging">
            <div class="pagingDisabled">ã€ˆã€ˆ</div>
            <div class="pagingDisabled">ã€ˆ</div>
            <div class="pagingActive">1</div>
            <div>2</div>
            <div>3</div>
            <div>4</div>
            <div>5</div>
            <div>6</div>
            <div>7</div>
            <div>8</div>
            <div>9</div>
            <div>10</div>
            <div>ã€‰</div>
            <div>ã€‰ã€‰</div>
        </div>
    </div>
</div>
</th:block>
</html>
<script>
    $(function(){

        $("#rtnAll").on("click", function(){
            let rtnAll = $(this).is(":checked");
            if(rtnAll) $('.rtnCheck').prop('checked', true);
            else $('.rtnCheck').prop('checked', false);
        });

        $("#userAll").on("click", function(){
            let userAll = $(this).is(":checked");
            if(userAll) $('.userCheck').prop('checked', true);
            else $('.userCheck').prop('checked', false);
        });

        $("#rtnDel").on("click", function(){
            if (confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
                const rtnGroup = [];
                $.each( $('.rtnCheck'), function() {
                    if ($(this).is(":checked")) {
                        rtnGroup.push($(this).val());
                    }
                });

                $.ajax({
                    url:'/auth/userGroup/deleteRtn',
                    type:'post',
                    data:{'rtnGroup': rtnGroup},
                    dataType:'json',
                    success: function(data){
                        if (data > 0){
                            alert('ì‚­ì œ ì™„ë£Œ');
                            location.reload();
                        }
                    }
                });
            } else {
                alert('ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        });

        $("#userDel").on("click", function (){
            if (confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
                const userGroup = [];
                $.each( $('.userCheck'), function() {
                    if ($(this).is(":checked")) {
                        let user = $(this).val() + "/" + $(this).data("code");
                        userGroup.push(user);
                    }
                });

                $.ajax({
                    url:'/auth/userGroup/deleteUser',
                    type:'post',
                    data:{'userGroup': userGroup},
                    dataType:'json',
                    success: function(data){
                        if (data > 0){
                            alert('ì‚­ì œ ì™„ë£Œ');
                            location.reload();
                        }
                    }
                });
            } else {
                alert('ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        });

        $("#searchBtn").on("click", function(){
            let id = $('.inputId').val();
            let code = $('#inputRtn').val();
            let name = $('.inputName').val();
            let table = $('#userTable');

            table.empty();

            $.ajax({
                url: '/auth/userGroup',
                type: 'post',
                data: {'id': id, 'code': code, 'name': name},
                dataType: 'json',
                success: function(data) {
                    var tags = '';
                    console.log(data.length);
                    $(data).each(function(){
                        tags += `<tr>`
                        tags += `  <td>`
                        tags += `    <input type="checkbox" class="userCheck" value="` + this.user_id+ `" data-code="` + this.rating_cd + `"/>`
                        tags += `  </td>`
                        tags += `  <td>` + this.user_id + `</td>`
                        tags += `  <td>` + this.rating_nm + `</td>`
                        tags += `  <td>` + this.user_nm + `</td>`
                        tags += `  <td>` + this.rmk + `</td>`
                        tags += `</tr>`

                    });
                    table.append(tags);
                }
            });
        });

    });
</script>